datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model MasterLayanan {
  idLayanan       Int      @id @default(autoincrement())
  namaLayanan     String
  rute            String
  jadwalBerangkat String
  hargaTiket      Float
  stokKursi       Int

  kendaraan TbKendaraan[] @relation("KendaraanToLayanan")
  pemesanan TbPemesanan[]
}

model TbKendaraan {
  idKendaraan    Int      @id @default(autoincrement())
  namaKendaraan  String
  jenisKendaraan String
  noPolisi       String
  kapasitas      Int

  // kalau mau hubungan 1 kendaraan bisa dipakai banyak layanan:
  layanan MasterLayanan[] @relation("KendaraanToLayanan")
}

model MasterUser {
  idUser   Int    @id @default(autoincrement())
  username String @unique
  password String
  role     String   // "admin" | "kasir" | "pelanggan"
}

model TbPelanggan {
  idPelanggan   Int    @id @default(autoincrement())
  namaPelanggan String
  noHp          String?
  email         String?

  pemesanan TbPemesanan[]
}

model TbPemesanan {
  idPemesanan   Int      @id @default(autoincrement())
  tglPemesanan  DateTime @default(now())
  jumlahKursi   Int
  totalBiaya    Float
  status        String   @default("DIBOOKING") // DIBOOKING/LUNAS/BATAL

  idLayanan   Int
  idPelanggan Int

  layanan   MasterLayanan @relation(fields: [idLayanan], references: [idLayanan])
  pelanggan TbPelanggan   @relation(fields: [idPelanggan], references: [idPelanggan])
  transaksi TbTransaksi?
}

model TbTransaksi {
  idTransaksi  Int      @id @default(autoincrement())
  tglTransaksi DateTime @default(now())
  jumlahBayar  Float
  metodeBayar  String

  idPemesanan Int      @unique
  pemesanan   TbPemesanan @relation(fields: [idPemesanan], references: [idPemesanan])
}

model User {
  id           Int    @id @default(autoincrement())
  nama         String
  username     String @unique
  passwordHash String
  role         String
}
